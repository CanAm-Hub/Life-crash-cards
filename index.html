<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recovery Card Table</title>
<style>
  body,html{margin:0;height:100%;font-family:system-ui;background:#f5f5f5;overflow:hidden}
#deck{position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:2px solid #ccc;
      transform:translateY(100%);transition:transform 0.3s ease-out;z-index:10;padding:10px 0;
      display:flex;flex-direction:column;gap:8px}
#deck.open{transform:translateY(0)}
.deck-handle{width:60px;height:10px;background:#ccc;border-radius:5px;margin:5px auto;cursor:grab}
.tab-bar{display:flex;gap:5px;overflow-x:auto;padding:10px 5px}
.tab{background:#eee;padding:8px 12px;border-radius:8px;cursor:pointer;white-space:nowrap;font-size:14px}
.active{background:#fff;border:1px solid #ccc}
#deckCards{display:flex;flex-wrap:wrap;gap:5px;padding:10px;justify-content:center}
.card{width:120px;height:80px;background:#fff;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.2);
      display:flex;align-items:center;justify-content:center;text-align:center;padding:4px;font-size:12px;
      touch-action:manipulation;user-select:none;position:absolute;cursor:grab}
.card:active{cursor:grabbing;transform:scale(1.05)}
.trigger{background:#FF5252;color:#fff}
.thought{background:#FFB300;color:#000}
.option{background:#4CAF50;color:#fff}
.recovery{background:#2196F3;color:#fff}
#canvas{position:relative;width:100%;height:100vh;overflow:auto;background:#fafafa;-webkit-overflow-scrolling:touch}
#addBtn{position:fixed;top:16px;right:16px;background:#333;color:#fff;padding:8px 16px;border-radius:50px;z-index:5}
</style>
</head>
<body>

<button id="addBtn">+ Card</button>
<div id="canvas"></div>

<div id="deck">
  <div class="tab-bar">
    <div class="tab active" data-cat="trigger">Triggers</div>
    <div class="tab" data-cat="thought">Thoughts</div>
    <div class="tab" data-cat="option">Options</div>
    <div class="tab" data-cat="recovery">Recovery</div>
  </div>
  <div id="deckCards"></div>
</div>

<script>
const canvas = document.getElementById('canvas');
const deck = document.getElementById('deck');
const deckCards = document.getElementById('deckCards');
const addBtn = document.getElementById('addBtn');

const templates = {
  trigger: ['I see alcohol ads','My ex texts me','Friday after work','Stress at job'],
  thought: ['One drink won’t hurt','I’m worthless','I deserve it'],
  option: ['Call sponsor','Go for a run','Write in journal','Deep breathe 4-7-8'],
  recovery: ['I stay sober tonight','I feel proud','I sleep well','I grow stronger']
};

let activeCat = 'trigger';
let cardId = 0;

// ---- Deck Tabs ----
document.querySelectorAll('.tab').forEach(tab => {
  tab.onclick = () => {
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    activeCat = tab.dataset.cat;
    renderDeck();
  };
});

// ---- Render Deck ----
function renderDeck() {
  deckCards.innerHTML = '';
  templates[activeCat].forEach(txt => {
    const el = document.createElement('div');
    el.className = `card ${activeCat}`;
    el.textContent = txt;
    el.draggable = true;
    el.ondragstart = ev => ev.dataTransfer.setData('text/plain', JSON.stringify({txt, cat:activeCat, id:++cardId}));
    deckCards.appendChild(el);
  });
}
renderDeck();

// ---- Canvas Drop ----
canvas.ondragover = e => e.preventDefault();
canvas.ondrop = e => {
  e.preventDefault();
  const data = JSON.parse(e.dataTransfer.getData('text/plain'));
  createCard(data.txt, data.cat, e.clientX, e.clientY);
};

// ---- Touch Drag (for phones) ----
let dragSrc = null;
canvas.addEventListener('pointerdown', e => {
  if (!e.target.classList.contains('card')) return;
  const card = e.target;
  dragSrc = card;
  const rect = canvas.getBoundingClientRect();
  const offsetX = e.clientX - card.offsetLeft - rect.left;
  const offsetY = e.clientY - card.offsetTop - rect.top;

  const move = ev => {
    card.style.left = (ev.clientX - rect.left - offsetX) + 'px';
    card.style.top  = (ev.clientY - rect.top  - offsetY) + 'px';
  };
  const up = () => {
    document.removeEventListener('pointermove', move);
    document.removeEventListener('pointerup', up);
    dragSrc = null;
  };
  document.addEventListener('pointermove', move);
  document.addEventListener('pointerup', up);
});

// ---- Create Card on Canvas ----
function createCard(text, cat, x, y) {
  const el = document.createElement('div');
  el.className = `card ${cat}`;
  el.textContent = text;
  el.style.left = (x - 70) + 'px';
  el.style.top  = (y - 45) + 'px';
  canvas.appendChild(el);
}

// ---- Swipe Deck Open/Close ----
let startY;
document.addEventListener('touchstart', e => { if(e.touches[0].clientY > window.innerHeight*0.8) startY = e.touches[0].clientY; });
document.addEventListener('touchmove', e => {
  if(!startY) return;
  const diff = startY - e.touches[0].clientY;
  deck.style.transform = `translateY(${Math.max(0,100 - diff*0.3)}%)`;
});
document.addEventListener('touchend', () => startY = null);

// ---- Add Custom Card ----
addBtn.onclick = () => {
  const txt = prompt('Enter your sentence:');
  if(!txt) return;
  const cat = activeCat;
  templates[cat].push(txt);
  renderDeck();
  createCard(txt, cat, innerWidth/2, innerHeight/2);
};
</script>
</body>
</html>
